{"version":3,"file":"raphael.group.min.js","sources":["../src/raphael.group.js"],"sourcesContent":["/* global Raphael */\r\n\r\n// TODO: fix transformation for VML\r\n// VML documentation: https://www.w3.org/TR/NOTE-VML\r\n\r\nconst scaleRegex = /scale\\([^)]*\\)/\r\nconst rotateRegex = /rotate\\([^)]*\\)/\r\nconst translateRegex = /translate\\([^)]*\\)/\r\n\r\nfunction adjustTransform (compareRegex, replacementString, transformString) {\r\n  let value = replacementString\r\n\r\n  if (transformString) {\r\n    value = (\r\n      compareRegex.test(transformString)\r\n      ? transformString.replace(compareRegex, replacementString)\r\n      : transformString.concat(' ', replacementString)\r\n    )\r\n  }\r\n\r\n  return value\r\n}\r\n\r\n// -----------------\r\n\r\n// TODO: add ramda to clean this up with curry()\r\nconst updateScale = (self, privates) => (scaleX, scaleY) => {\r\n  if (privates.isVML) {\r\n\r\n  } else {\r\n    const transform = self.node.getAttribute('transform')\r\n    const value = adjustTransform(scaleRegex, `scale(${scaleX} ${scaleY})`, transform)\r\n\r\n    self.node.setAttribute('transform', value)\r\n  }\r\n}\r\n\r\nconst updateRotation = (self, privates) => (rotation) => {\r\n  if (privates.isVML) {\r\n\r\n  } else {\r\n    const transform = self.node.getAttribute('transform')\r\n    const value = adjustTransform(rotateRegex, `rotate(${rotation})`, transform)\r\n\r\n    self.node.setAttribute('transform', value)\r\n  }\r\n}\r\n\r\nconst updateTranslation = (self, privates) => (x, y) => {\r\n  if (privates.isVML) {\r\n    self.node.style.left = x + 'px'\r\n    self.node.style.top = y + 'px'\r\n  } else {\r\n    const transform = self.node.getAttribute('transform')\r\n    const value = adjustTransform(translateRegex, `translate(${x} ${y})`, transform)\r\n\r\n    self.node.setAttribute('transform', value)\r\n  }\r\n}\r\n\r\nconst onMove = (self, privates) => (dx, dy) => {\r\n  privates.lx = (dx * self.dragSpeed) + privates.ox\r\n  privates.ly = (dy * self.dragSpeed) + privates.oy\r\n  self.translate(privates.lx, privates.ly)\r\n}\r\n\r\nconst onStart = (self, privates) => () => {\r\n  if (self.node.hasAttribute('transform')) {\r\n    let transform = self.node.getAttribute('transform').match(/translate\\(([^)]*)\\)/)\r\n    if (transform && transform[1] !== undefined) {\r\n      const [x, y] = transform[1].split(' ').map(num => parseFloat(num))\r\n      privates.ox = x\r\n      privates.oy = y\r\n    }\r\n  }\r\n}\r\n\r\nconst onEnd = (self, privates) => () => {\r\n  privates.ox = privates.lx\r\n  privates.oy = privates.ly\r\n}\r\n\r\nconst pushOneRaphaelVector = (self, privates) => (item) => {\r\n  if (item.type === 'set') {\r\n    item.forEach(pushOneRaphaelVector(self, privates))\r\n  } else {\r\n    self.node.appendChild(item.node)\r\n    self.set.push(item)\r\n  }\r\n}\r\n\r\n// -----------------\r\n\r\nconst _ = new WeakMap()\r\n\r\nclass Group {\r\n  constructor (raphael, items) {\r\n    const privates = {\r\n      lx: 0,\r\n      ly: 0,\r\n      ox: 0,\r\n      oy: 0,\r\n      isVML: raphael.raphael.vml\r\n    }\r\n\r\n    let group\r\n\r\n    if (privates.isVML) {\r\n      group = document.createElement('rvml:group')\r\n\r\n      /*\r\n      group.style.behavior = 'url(#default#VML)';\r\n      group.style.position = 'absolute';\r\n      group.style.filter = '';\r\n      group.style.width = '100px';\r\n      group.style.height = '100px';\r\n      group.style.top = '0px';\r\n      group.style.left = '0px';\r\n      group.className = 'rvml';\r\n      */\r\n    } else {\r\n      group = document.createElementNS('http://www.w3.org/2000/svg', 'g')\r\n    }\r\n\r\n    raphael.canvas.appendChild(group)\r\n\r\n    this.set = raphael.set(items)\r\n    this.dragSpeed = 1\r\n    this.node = group\r\n    this.type = 'group'\r\n\r\n    privates.onMove = onMove(this, privates)\r\n    privates.onStart = onStart(this, privates)\r\n    privates.onEnd = onEnd(this, privates)\r\n    privates.pushOneRaphaelVector = pushOneRaphaelVector(this, privates)\r\n    privates.updateScale = updateScale(this, privates)\r\n    privates.updateRotation = updateRotation(this, privates)\r\n    privates.updateTranslation = updateTranslation(this, privates)\r\n\r\n    _.set(this, privates)\r\n  }\r\n\r\n  scale (newScaleX, newScaleY) {\r\n    _.get(this).updateScale(newScaleX, newScaleY === undefined ? newScaleX : newScaleY)\r\n    return this\r\n  }\r\n  rotate (deg) {\r\n    _.get(this).updateRotation(deg)\r\n    return this\r\n  }\r\n  translate (newTranslateX, newTranslateY) {\r\n    _.get(this).updateTranslation(newTranslateX, newTranslateY)\r\n    return this\r\n  }\r\n  push (item) {\r\n    _.get(this).pushOneRaphaelVector(item)\r\n    return this\r\n  }\r\n  getBBox () {\r\n    return this.set.getBBox()\r\n  }\r\n  draggable () {\r\n    const privates = _.get(this)\r\n    this.set.drag(privates.onMove, privates.onStart, privates.onEnd)\r\n    return this\r\n  }\r\n}\r\n\r\nRaphael.fn.group = function (items = []) {\r\n  return new Group(this, items)\r\n}\r\n"],"names":["adjustTransform","compareRegex","replacementString","transformString","let","value","test","replace","concat","const","scaleRegex","rotateRegex","translateRegex","updateScale","self","privates","scaleX","scaleY","isVML","transform","node","getAttribute","setAttribute","updateRotation","rotation","updateTranslation","x","y","style","left","top","onMove","dx","dy","lx","dragSpeed","ox","ly","oy","translate","onStart","hasAttribute","match","undefined","split","map","num","parseFloat","onEnd","pushOneRaphaelVector","item","type","forEach","appendChild","set","push","_","WeakMap","Group","raphael","items","group","vml","document","createElement","createElementNS","canvas","this","scale","newScaleX","newScaleY","get","rotate","deg","newTranslateX","newTranslateY","getBBox","draggable","drag","Raphael","fn"],"mappings":";0CASA,SAASA,EAAiBC,EAAcC,EAAmBC,GACzDC,IAAIC,EAAQH,EAUZ,OARIC,IACFE,EACEJ,EAAaK,KAAKH,GAChBA,EAAgBI,QAAQN,EAAcC,GACtCC,EAAgBK,OAAO,IAAKN,IAI3BG,EAfTI,IAAMC,EAAa,iBACbC,EAAc,kBACdC,EAAiB,qBAmBjBC,EAAc,SAACC,EAAMC,UAAa,SAACC,EAAQC,GAC/C,GAAIF,EAASG,WAEN,CACLT,IAAMU,EAAYL,EAAKM,KAAKC,aAAa,aACnChB,EAAQL,EAAgBU,EAAY,SAASM,MAAUC,MAAWE,GAExEL,EAAKM,KAAKE,aAAa,YAAajB,MAIlCkB,EAAiB,SAACT,EAAMC,UAAa,SAACS,GAC1C,GAAIT,EAASG,WAEN,CACLT,IAAMU,EAAYL,EAAKM,KAAKC,aAAa,aACnChB,EAAQL,EAAgBW,EAAa,UAAUa,MAAaL,GAElEL,EAAKM,KAAKE,aAAa,YAAajB,MAIlCoB,EAAoB,SAACX,EAAMC,UAAa,SAACW,EAAGC,GAChD,GAAIZ,EAASG,MACXJ,EAAKM,KAAKQ,MAAMC,KAAOH,EAAI,KAC3BZ,EAAKM,KAAKQ,MAAME,IAAMH,EAAI,SACrB,CACLlB,IAAMU,EAAYL,EAAKM,KAAKC,aAAa,aACnChB,EAAQL,EAAgBY,EAAgB,aAAac,MAAKC,MAAMR,GAEtEL,EAAKM,KAAKE,aAAa,YAAajB,MAIlC0B,EAAS,SAACjB,EAAMC,UAAa,SAACiB,EAAIC,GACtClB,EAASmB,GAAMF,EAAKlB,EAAKqB,UAAapB,EAASqB,GAC/CrB,EAASsB,GAAMJ,EAAKnB,EAAKqB,UAAapB,EAASuB,GAC/CxB,EAAKyB,UAAUxB,EAASmB,GAAInB,EAASsB,MAGjCG,EAAU,SAAC1B,EAAMC,UAAa,WAClC,GAAID,EAAKM,KAAKqB,aAAa,aAAc,CACvCrC,IAAIe,EAAYL,EAAKM,KAAKC,aAAa,aAAaqB,MAAM,wBAC1D,GAAIvB,QAA8BwB,IAAjBxB,EAAU,GAAkB,CAC3C,MAAeA,EAAU,GAAGyB,MAAM,KAAKC,IAAI,SAAAC,UAAOC,WAAWD,KAAtDpB,OAAGC,OACVZ,EAASqB,GAAKV,EACdX,EAASuB,GAAKX,MAKdqB,EAAQ,SAAClC,EAAMC,UAAa,WAChCA,EAASqB,GAAKrB,EAASmB,GACvBnB,EAASuB,GAAKvB,EAASsB,KAGnBY,EAAuB,SAACnC,EAAMC,UAAa,SAACmC,GAC9B,QAAdA,EAAKC,KACPD,EAAKE,QAAQH,EAAqBnC,EAAMC,KAExCD,EAAKM,KAAKiC,YAAYH,EAAK9B,MAC3BN,EAAKwC,IAAIC,KAAKL,MAMZM,EAAI,IAAIC,QAERC,EAAM,SACGC,EAASC,GACtB,IAQMC,EARE9C,GACNmB,GAAM,EACNG,GAAM,EACND,GAAM,EACNE,GAAM,EACNpB,MAASyC,EAAQA,QAAQG,KAMzBD,EADI9C,EAASG,MACH6C,SAASC,cAAc,cAavBD,SAASE,gBAAgB,6BAA8B,KAGnEN,EAAUO,OAAOb,YAAYQ,GAE7BM,KAAOb,IAAMK,EAAQL,IAAIM,GACzBO,KAAOhC,UAAY,EACnBgC,KAAO/C,KAAOyC,EACdM,KAAOhB,KAAO,QAEdpC,EAAWgB,OAASA,EAAOoC,KAAMpD,GACjCA,EAAWyB,QAAUA,EAAQ2B,KAAMpD,GACnCA,EAAWiC,MAAQA,EAAMmB,EAAMpD,GAC/BA,EAAWkC,qBAAuBA,EAAqBkB,KAAMpD,GAC7DA,EAAWF,YAAcA,EAAYsD,KAAMpD,GAC3CA,EAAWQ,eAAiBA,EAAe4C,KAAMpD,GACjDA,EAAWU,kBAAoBA,EAAkB0C,KAAMpD,GAEvDyC,EAAIF,IAAIa,KAAMpD,WAGhB2C,YAAEU,eAAOC,EAAWC,GAElB,OADAd,EAAIe,IAAIJ,MAAMtD,YAAYwD,OAAyB1B,IAAd2B,EAA0BD,EAAYC,GAClEH,MAEXT,YAAEc,gBAAQC,GAER,OADAjB,EAAIe,IAAIJ,MAAM5C,eAAekD,GACpBN,MAEXT,YAAEnB,mBAAWmC,EAAeC,GAE1B,OADAnB,EAAIe,IAAIJ,MAAM1C,kBAAkBiD,EAAeC,GACtCR,MAEXT,YAAEH,cAAML,GAEN,OADAM,EAAIe,IAAIJ,MAAMlB,qBAAqBC,GAC1BiB,MAEXT,YAAEkB,mBACA,OAAST,KAAKb,IAAIsB,WAEpBlB,YAAEmB,qBACA,IAAQ9D,EAAWyC,EAAEe,IAAIJ,MAEzB,OADAA,KAAOb,IAAIwB,KAAK/D,EAASgB,OAAQhB,EAASyB,QAASzB,EAASiC,OACnDmB,MAIXY,QAAQC,GAAGnB,MAAQ,SAAUD,GAC3B,0BAAO,IAAIF,EAAMS,KAAMP"}